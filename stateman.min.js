!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StateMan=e():t.StateMan=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r=n(1);r.Histery=n(8),r.util=n(3),r.State=n(2),t.exports=r},function(t,e,n){function r(t){return this instanceof r==!1?new r(t):(t=t||{},this._states={},this._stashCallback=[],this.strict=t.strict,this.current=this.active=this,this.title=t.title,void this.on("end",function(){for(var t,e=this.current;e&&!(t=e.title);)e=e.parent;document.title="function"==typeof t?e.title():String(t||s)}))}var i=n(2),o=n(8),a=(n(9),n(3)),s=document.title,c=i.prototype.state;a.extend(a.emitable(r),{name:"",state:function(t,e){var n=this.active;return"string"==typeof t&&n&&(t=t.replace("~",n.name),n.parent&&(t=t.replace("^",n.parent.name||""))),c.apply(this,arguments)},start:function(t){return this.history||(this.history=new o(t)),this.history.isStart||(this.history.on("change",a.bind(this._afterPathChange,this)),this.history.start()),this},stop:function(){this.history.stop()},go:function(t,e,n){e=e||{};var r;if("string"==typeof t&&(r=t,t=this.state(t)),!t)return this._notfound({state:r});if("function"==typeof e&&(n=e,e={}),e.encode!==!1){var i=t.encode(e.param);e.path=i,this.nav(i,{silent:!0,replace:e.replace})}return this._go(t,e,n),this},nav:function(t,e,n){return"function"==typeof e&&(n=e,e={}),e=e||{},e.path=t,this.history.nav(t,a.extend({silent:!0},e)),e.silent||this._afterPathChange(a.cleanPath(t),e,n),this},decode:function(t){var e=t.split("?"),n=this._findQuery(e[1]);t=e[0];var r=this._findState(this,t);return r&&a.extend(r.param,n),r},encode:function(t,e){var n=this.state(t);return n?n.encode(e):""},is:function(t,e,n){if(!t)return!1;var t=t.name||t,r=this.current,i=r.name,o=n?i===t:0===(i+".").indexOf(t+".");return o&&(!e||a.eql(e,this.param))},_afterPathChange:function(t,e,n){this.emit("history:change",t);var r=this.decode(t);return e=e||{},e.path=t,r?(e.param=r.param,void this._go(r,e,n)):this._notfound(e)},_notfound:function(t){return this.emit("notfound",t)},_go:function(t,e,n){function r(t){i=!0,t!==!1&&h.emit("end"),h.pending=null,h._popStash(e)}var i;if(t.hasNext&&this.strict)return this._notfound({name:t.name});e.param=e.param||{};var o=this.current,s=this._findBase(o,t),c=this.path,h=this;"function"==typeof n&&this._stashCallback.push(n),e.previous=o,e.current=t,o!==t&&(e.stop=function(){r(!1),h.nav(c?c:"/",{silent:!0})},h.emit("begin",e)),i!==!0&&(o!==t?(e.phase="permission",this._walk(o,t,e,!0,a.bind(function(n){return n===!1?(c&&this.nav(c,{silent:!0}),r(!1,2),this.emit("abort",e)):(this.pending&&this.pending.stop(),this.pending=e,this.path=e.path,this.current=e.current,this.param=e.param,this.previous=e.previous,e.phase="navigation",void this._walk(o,t,e,!1,a.bind(function(t){return t===!1?(this.current=this.active,r(!1),this.emit("abort",e)):(this.active=e.current,e.phase="completion",r())},this)))},this))):(h._checkQueryAndParam(s,e),this.pending=null,r()))},_popStash:function(t){var e=this._stashCallback,n=e.length;if(this._stashCallback=[],n)for(var r=0;n>r;r++)e[r].call(this,t)},_walk:function(t,e,n,r,i){var o=this._findBase(t,e);n.basckward=!0,this._transit(t,o,n,r,a.bind(function(t){return t===!1?i(t):(r||this._checkQueryAndParam(o,n),n.basckward=!1,void this._transit(o,e,n,r,i))},this))},_transit:function(t,e,n,r,i){if(t===e)return i();var o,s=t.name.length>e.name.length,c=s?"leave":"enter";r&&(c="can"+c.replace(/^\w/,function(t){return t.toUpperCase()}));var h=a.bind(function(r){return o===e||r===!1?i(r):(o=o?this._computeNext(o,e):s?t:this._computeNext(t,e),s&&o===e||!o?i(r):void this._moveOn(o,c,n,h))},this);h()},_moveOn:function(t,e,n,r){function i(t){o||(s=!1,o=!0,r(t))}var o=!1,s=!1;n.async=function(){return s=!0,i},n.stop=function(){i(!1)},this.active=t;var c=t[e]?t[e](n):!0;return"enter"===e&&(t.visited=!0),a.isPromise(c)?this._wrapPromise(c,i):void(s||i(c))},_wrapPromise:function(t,e){return t.then(e,function(){e(!1)})},_computeNext:function(t,e){var n=t.name,r=e.name,i=r.split("."),o=n.split("."),a=i.length,s=o.length;return""===n&&(s=0),""===r&&(a=0),a>s?o[s]=i[s]:o.pop(),this.state(o.join("."))},_findQuery:function(t){var e=t&&t.split("&"),n={};if(e)for(var r=e.length,n={},i=0;r>i;i++){var o=e[i].split("=");n[o[0]]=o[1]}return n},_findState:function(t,e){var n,r,i=t._states;if(t.hasNext)for(var o in i)if(i.hasOwnProperty(o)&&(n=this._findState(i[o],e)))return n;return r=t.regexp&&t.decode(e),r?(t.param=r,t):!1},_findBase:function(t,e){if(!t||!e||t==this||e==this)return this;for(var n,r=t,i=e;r&&i;){for(n=i;n;){if(r===n)return n;n=n.parent}r=r.parent}},_checkQueryAndParam:function(t,e){for(var n=t;n!==this;)n.update&&n.update(e),n=n.parent}},!0),t.exports=r},function(t,e,n){function r(t){this._states={},this._pending=!1,this.visited=!1,t&&this.config(t)}var i=n(3),o=n(4);r.rCache={},i.extend(i.emitable(r),{state:function(t,e){if("object"===i.typeOf(t)){for(var n in t)this.state(n,t[n]);return this}var o,a,s,c=this._states,n=0;"string"==typeof t&&(t=t.split("."));var h=t.length,o=this,u=[];do{if(s=t[n],a=c[s],u.push(s),!a){if(!e)return;a=c[s]=new r,i.extend(a,{parent:o,manager:o.manager||o,name:u.join("."),currentName:s}),o.hasNext=!0,a.configUrl()}o=a,c=a._states}while(++n<h);return e?(a.config(e),this):o},config:function(t){t=this._getConfig(t);for(var e in t){var n=t[e];switch(e){case"url":"string"==typeof n&&(this.url=n,this.configUrl());break;case"events":this.on(n);break;default:this[e]=n}}},_getConfig:function(t){return"function"==typeof t?{enter:t}:t},configUrl:function(){for(var t="",e=this;e;){if(t=("string"==typeof e.url?e.url:e.currentName||"")+"/"+t,0===t.indexOf("^/")){t=t.slice(1);break}e=e.parent}this.pattern=i.cleanPath("/"+t);var n=this.pattern.split("?");this.pattern=n[0],i.extend(this,i.normalize(this.pattern),!0)},encode:function(t){var e=o.stringify(t);return e},decode:function(t){var e=o.parse(t);return e},async:function(){throw new Error("please use option.async instead")}}),t.exports=r},function(t,e){function n(t){var e=0,n=[],i=0,o="";t=r.cleanPath(t);var a=t.replace(/\:([\w-]+)(?:\(([^\/]+?)\))?|(?:\(([^\/]+)\))|(\*{2,})|(\*(?!\*))/g,function(r,a,s,c,h,u,f){return f>e&&(o+=t.slice(e,f)),e=f+r.length,a?(o+="("+a+")",n.push(a),"("+(s||"[\\w-]+")+")"):(o+="("+i+")",n.push(i++),c?"("+c+")":h?"(.*)":u?"([^\\/]*)":void 0)});return e!==t.length&&(o+=t.slice(e)),{regexp:new RegExp("^"+a+"/?$"),keys:n,matches:o||t}}var r=t.exports={},i=[].slice,o={}.toString;r.extend=function(t,e,n){for(var r in e)(n||void 0===t[r])&&(t[r]=e[r]);return t},r.slice=function(t,e){return i.call(t,e)},r.typeOf=function(t){return null==t?String(t):o.call(t).slice(8,-1).toLowerCase()},r.eql=function(t,e){var n=r.typeOf(t),i=r.typeOf(e);if(n!==i)return!1;if("object"===n){for(var o in t)if(t[o]!==e[o])return!1;return!0}return t===e},r.emitable=function(){function t(t){var e=(t||"").split(":");return{event:e[0],namespace:e[1]}}var e={once:function(t,e){var n=function(){e.apply(this,arguments),this.off(t,n)};return this.on(t,n)},on:function(e,n){if("object"==typeof e){for(var r in e)this.on(r,e[r]);return this}var i=t(e);if(e=i.event,e&&"function"==typeof n){var o=this._handles||(this._handles={}),a=o[e]||(o[e]=[]);n._ns=i.namespace,a.push(n)}return this},off:function(e,n){var r=t(e);e=r.event,e&&this._handles||(this._handles={});var i,o=this._handles;if(i=o[e])if(n||r.namespace){for(var a=0,s=i.length;s>a;a++)if(!(n&&n!==i[a]||r.namespace&&i[a]._ns!==r.namespace))return i.splice(a,1),this}else o[e]=[];return this},emit:function(e){var n=t(e);e=n.event;var i,o=r.slice(arguments,1),a=this._handles;if(!a||!(i=a[e]))return this;for(var s=0,c=i.length;c>s;s++){var h=i[s];n.namespace&&h._ns!==n.namespace||h.apply(this,o)}return this}};return function(t){return t="function"==typeof t?t.prototype:t,r.extend(t,e)}}(),r.bind=function(t,e){return function(){return t.apply(e,arguments)}};var a=/\/+/g,s=/\/$/;r.cleanPath=function(t){return("/"+t).replace(a,"/").replace(s,"")||"/"},r.log=function(t,e){"undefined"!=typeof console&&console[e||"log"](t)},r.isPromise=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then},r.normalize=n},function(t,e,n){"use strict";var r=n(5),i=n(7);t.exports={stringify:r,parse:i}},function(t,e,n){"use strict";var r=n(6),i={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},o={delimiter:"&",strictNullHandling:!1,skipNulls:!1,encode:!0,encoder:r.encode},a=function s(t,e,n,i,o,a,c,h,u){var f=t;if("function"==typeof c)f=c(e,f);else if(f instanceof Date)f=f.toISOString();else if(null===f){if(i)return a?a(e):e;f=""}if("string"==typeof f||"number"==typeof f||"boolean"==typeof f||r.isBuffer(f))return a?[a(e)+"="+a(f)]:[e+"="+String(f)];var l=[];if("undefined"==typeof f)return l;var p;if(Array.isArray(c))p=c;else{var d=Object.keys(f);p=h?d.sort(h):d}for(var m=0;m<p.length;++m){var v=p[m];o&&null===f[v]||(l=Array.isArray(f)?l.concat(s(f[v],n(e,v),n,i,o,a,c,h,u)):l.concat(s(f[v],e+(u?"."+v:"["+v+"]"),n,i,o,a,c,h,u)))}return l};t.exports=function(t,e){var n,r,s=t,c=e||{},h="undefined"==typeof c.delimiter?o.delimiter:c.delimiter,u="boolean"==typeof c.strictNullHandling?c.strictNullHandling:o.strictNullHandling,f="boolean"==typeof c.skipNulls?c.skipNulls:o.skipNulls,l="boolean"==typeof c.encode?c.encode:o.encode,p=l?"function"==typeof c.encoder?c.encoder:o.encoder:null,d="function"==typeof c.sort?c.sort:null,m="undefined"==typeof c.allowDots?!1:c.allowDots;if(null!==c.encoder&&void 0!==c.encoder&&"function"!=typeof c.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof c.filter?(r=c.filter,s=r("",s)):Array.isArray(c.filter)&&(n=r=c.filter);var v=[];if("object"!=typeof s||null===s)return"";var y;y=c.arrayFormat in i?c.arrayFormat:"indices"in c?c.indices?"indices":"repeat":"indices";var g=i[y];n||(n=Object.keys(s)),d&&n.sort(d);for(var b=0;b<n.length;++b){var _=n[b];f&&null===s[_]||(v=v.concat(a(s[_],_,g,u,f,p,r,d,m)))}return v.join(h)}},function(t,e){"use strict";var n=function(){for(var t=new Array(256),e=0;256>e;++e)t[e]="%"+((16>e?"0":"")+e.toString(16)).toUpperCase();return t}();e.arrayToObject=function(t,e){for(var n=e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)"undefined"!=typeof t[r]&&(n[r]=t[r]);return n},e.merge=function(t,n,r){if(!n)return t;if("object"!=typeof n){if(Array.isArray(t))t.push(n);else{if("object"!=typeof t)return[t,n];t[n]=!0}return t}if("object"!=typeof t)return[t].concat(n);var i=t;return Array.isArray(t)&&!Array.isArray(n)&&(i=e.arrayToObject(t,r)),Object.keys(n).reduce(function(t,i){var o=n[i];return Object.prototype.hasOwnProperty.call(t,i)?t[i]=e.merge(t[i],o,r):t[i]=o,t},i)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),r="",i=0;i<e.length;++i){var o=e.charCodeAt(i);45===o||46===o||95===o||126===o||o>=48&&57>=o||o>=65&&90>=o||o>=97&&122>=o?r+=e.charAt(i):128>o?r+=n[o]:2048>o?r+=n[192|o>>6]+n[128|63&o]:55296>o||o>=57344?r+=n[224|o>>12]+n[128|o>>6&63]+n[128|63&o]:(i+=1,o=65536+((1023&o)<<10|1023&e.charCodeAt(i)),r+=n[240|o>>18]+n[128|o>>12&63]+n[128|o>>6&63]+n[128|63&o])}return r},e.compact=function(t,n){if("object"!=typeof t||null===t)return t;var r=n||[],i=r.indexOf(t);if(-1!==i)return r[i];if(r.push(t),Array.isArray(t)){for(var o=[],a=0;a<t.length;++a)t[a]&&"object"==typeof t[a]?o.push(e.compact(t[a],r)):"undefined"!=typeof t[a]&&o.push(t[a]);return o}for(var s=Object.keys(t),c=0;c<s.length;++c){var h=s[c];t[h]=e.compact(t[h],r)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null===t||"undefined"==typeof t?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}},function(t,e,n){"use strict";var r=n(6),i=Object.prototype.hasOwnProperty,o={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,decoder:r.decode},a=function(t,e){for(var n={},r=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),o=0;o<r.length;++o){var a,s,c=r[o],h=-1===c.indexOf("]=")?c.indexOf("="):c.indexOf("]=")+1;-1===h?(a=e.decoder(c),s=e.strictNullHandling?null:""):(a=e.decoder(c.slice(0,h)),s=e.decoder(c.slice(h+1))),i.call(n,a)?n[a]=[].concat(n[a]).concat(s):n[a]=s}return n},s=function h(t,e,n){if(!t.length)return e;var r,i=t.shift();if("[]"===i)r=[],r=r.concat(h(t,e,n));else{r=n.plainObjects?Object.create(null):{};var o="["===i[0]&&"]"===i[i.length-1]?i.slice(1,i.length-1):i,a=parseInt(o,10);!isNaN(a)&&i!==o&&String(a)===o&&a>=0&&n.parseArrays&&a<=n.arrayLimit?(r=[],r[a]=h(t,e,n)):r[o]=h(t,e,n)}return r},c=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^\.\[]+)/g,"[$1]"):t,o=/^([^\[\]]*)/,a=/(\[[^\[\]]*\])/g,c=o.exec(r),h=[];if(c[1]){if(!n.plainObjects&&i.call(Object.prototype,c[1])&&!n.allowPrototypes)return;h.push(c[1])}for(var u=0;null!==(c=a.exec(r))&&u<n.depth;)u+=1,(n.plainObjects||!i.call(Object.prototype,c[1].replace(/\[|\]/g,""))||n.allowPrototypes)&&h.push(c[1]);return c&&h.push("["+r.slice(c.index)+"]"),s(h,e,n)}};t.exports=function(t,e){var n=e||{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.delimiter="string"==typeof n.delimiter||r.isRegExp(n.delimiter)?n.delimiter:o.delimiter,n.depth="number"==typeof n.depth?n.depth:o.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:o.arrayLimit,n.parseArrays=n.parseArrays!==!1,n.decoder="function"==typeof n.decoder?n.decoder:o.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:o.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:o.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:o.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:o.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:o.strictNullHandling,""===t||null===t||"undefined"==typeof t)return n.plainObjects?Object.create(null):{};for(var i="string"==typeof t?a(t,n):t,s=n.plainObjects?Object.create(null):{},h=Object.keys(i),u=0;u<h.length;++u){var f=h[u],l=c(f,i[f],n);s=r.merge(s,l,n)}return r.compact(s)}},function(t,e,n){function r(t){t=t||{},this.location=t.location||i.location,this.html5=t.html5,this.mode=t.html5&&i.history?c:s,i.hash||(this.mode=a),t.mode&&(this.mode=t.mode),this.prefix="#"+(t.prefix||""),this.rPrefix=new RegExp(this.prefix+"(.*)$"),this.interval=t.interval||66,this.root=t.root||"/",this.rRoot=new RegExp("^"+this.root),this._fixInitState(),this.autolink=t.autolink!==!1,this.curPath=void 0}var i=n(9),o=n(3),a=3,s=1,c=2;o.extend(o.emitable(r),{start:function(){var t=this.getPath();if(this._checkPath=o.bind(this.checkPath,this),!this.isStart){switch(this.isStart=!0,this.mode===a&&this._fixHashProbelm(t),this.mode){case s:i.on(window,"hashchange",this._checkPath);break;case c:i.on(window,"popstate",this._checkPath);break;case a:this._checkLoop()}this.autolink&&this._autolink(),this.curPath=t,this.emit("change",t)}},stop:function(){i.off(window,"hashchange",this._checkPath),i.off(window,"popstate",this._checkPath),clearTimeout(this.tid),this.isStart=!1,this._checkPath=null},checkPath:function(t){var e=this.getPath(),n=this.curPath;e===n&&this.iframe&&(e=this.getPath(this.iframe.location)),e!==n&&(this.iframe&&this.nav(e,{silent:!0}),this.curPath=e,this.emit("change",e))},getPath:function(t){var e,t=t||this.location;return this.mode!==c?(e=t.href.match(this.rPrefix),e&&e[1]?e[1]:""):o.cleanPath((t.pathname+t.search||"").replace(this.rRoot,"/"))},nav:function(t,e){var n=this.iframe;e=e||{},t=o.cleanPath(t),this.curPath!=t&&(this.curPath=t,this.mode!==c?(this._setHash(this.location,t,e.replace),n&&this.getPath(n.location)!==t&&(e.replace||n.document.open().close(),this._setHash(this.iframe.location,t,e.replace))):history[e.replace?"replaceState":"pushState"]({},e.title||"",o.cleanPath(this.root+t)),e.silent||this.emit("change",t))},_autolink:function(){if(this.mode===c){var t=(this.prefix,this);i.on(document.body,"click",function(e){var n=e.target||e.srcElement;if("a"===n.tagName.toLowerCase()){var r=i.isSameDomain(n.href)&&(i.getHref(n)||"").match(t.rPrefix),o=r&&r[1]?r[1]:"";if(o)return e.preventDefault&&e.preventDefault(),t.nav(o),e.returnValue=!1}})}},_setHash:function(t,e,n){var r=t.href.replace(/(javascript:|#).*$/,"");n?t.replace(r+this.prefix+e):t.hash=this.prefix+e},_checkLoop:function(){var t=this;this.tid=setTimeout(function(){t._checkPath(),t._checkLoop()},this.interval)},_fixInitState:function(){var t,e,n=o.cleanPath(this.location.pathname);this.mode!==c&&this.html5?(e=n.replace(this.rRoot,""),e&&this.location.replace(this.root+this.prefix+e)):this.mode===c&&(t=this.location.hash.replace(this.prefix,""),t&&history.replaceState({},document.title,o.cleanPath(this.root+t)))},_fixHashProbelm:function(t){var e=document.createElement("iframe"),n=document.body;e.src="javascript:;",e.style.display="none",e.tabIndex=-1,e.title="",this.iframe=n.insertBefore(e,n.firstChild).contentWindow,this.iframe.document.open().close(),this.iframe.location.hash="#"+t}}),t.exports=r},function(t,e){var n=window,r=document;t.exports={hash:"onhashchange"in n&&(!r.documentMode||r.documentMode>7),history:n.history&&"onpopstate"in n,location:n.location,isSameDomain:function(t){var e=t.match(/^.*?:\/\/([^\/]*)/);return e?e[0]==this.location.origin:!0},getHref:function(t){return"href"in t?t.getAttribute("href",2):t.getAttribute("href")},on:"addEventListener"in n?function(t,e,n){return t.addEventListener(e,n)}:function(t,e,n){return t.attachEvent("on"+e,n)},off:"removeEventListener"in n?function(t,e,n){return t.removeEventListener(e,n)}:function(t,e,n){return t.detachEvent("on"+e,n)}}}])});